{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday ‚ù§Ô∏è</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css?family=VT323" rel="stylesheet">
    
    <link rel="stylesheet" href="{% static 'backgroundmusic/music.css' %}">
    
   
    <style>
        /* Base styles - CRITICAL FIX FOR SCROLLING */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            
            /* FIX: Remove overflow: hidden; and allow vertical scrolling */
            overflow-x: hidden; /* Prevent horizontal scrolling */
            overflow-y: auto; /* Allow vertical scrolling */
            
            /* UPDATED: Set base background to match sections */
            background-color: #000000; 
            scroll-behavior: smooth; /* Optional: Makes scrolling smoother */
        }
        
        .section {
            display: block;
            width: 100%;
            min-height: 100vh; /* Ensures each section takes up at least one full screen */
            position: relative;
        }

        /* Cracker Canvas style */
        #cracker-canvas {
            position: fixed; /* CRITICAL FIX: To make the canvas a permanent background effect */
            top: 0;
            left: 0;
            z-index: 5;
            width: 100vw; /* Use vw/vh for consistent viewport sizing */
            height: 100vh;
            pointer-events: none; /* Allows clicks/scrolling 'through' the canvas */
        }
        
        /* The first section needs a height to contain the canvas */
        #birthday-crackers {
            height: 100vh; /* Now acting as a full-page scroll stop */
        }
        
        /* The content of the second section needs to be above the canvas */
        #photos {
            z-index: 10; /* Higher than canvas (z-index: 5) */
            position: relative; /* Needed for z-index to work */
            /* The styles for flex/padding are fine as they are */
        }

        /* Center the animated text title (now unused, but keeping the rule) */
        .cracker-title {
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%);
            color: white; 
            font-size: 4rem; 
            font-family: Arial; 
            z-index: 10; 
            text-align: center;
            opacity: 0; 
            pointer-events: none;
        }

        /* Hiding unused CSS elements from birthday_crackers.html */
        #cake, .velas, .fuego, p { display: none; }
        
    </style>
</head>
<body>

<audio id="birthday-audio">
    <source src="{% static 'backgroundmusic/I_Think_They_Call_This_Love_Cover.mp3' %}" type="audio/mpeg">
</audio>

<div class="heart-player">
    <div class="heart-icon" id="heart-icon">
        <i class="fas fa-heart"></i>
    </div>
</div>

<section id="birthday-crackers" class="section" style="background:#000000;">
    
    <canvas id="cracker-canvas"></canvas></section>


<section id="photos" class="section" style="background:#000000; display:flex; justify-content:center; align-items:center; padding:50px; right:50px;">


    <div class="container">
    <div class="box box-1" style="--img: url('{% static 'images/13.jpg' %}');" data-text="PREETU"></div>
    <div class="box box-2" style="--img: url('{% static 'images/2.jpg' %}');" data-text="Suarni"></div>
    <div class="box box-3" style="--img: url('{% static 'images/5.png' %}');" data-text="beauty"></div>
    <div class="box box-4" style="--img: url('{% static 'images/6.png' %}');" data-text="kaalo"></div>
    <div class="box box-5" style="--img: url('{% static 'images/4.png' %}');" data-text="cutie"></div>
</div>
</section>



<div id="next-surprise-section" style="text-align:center; padding: 40px 20px; background:#233841;">
    <a href="{% url 'page5' %}"
       style="
             padding:15px 35px;
             background:#33ff66;
             color:black;
             font-family:'VT323', monospace;
             font-size:32px;
             border-radius:10px;
             text-decoration:none;
             border:3px solid #285685;
             display:inline-block;
             transition:0.3s;
             position: relative;
            z-index: 9999;

       "
       onmouseover="this.style.background='#1aff55'"
       onmouseout="this.style.background='#33ff66'">
        Next Surprise üéà
    </a>
</div>

<script>
    /* The entire JavaScript logic for the canvas animation remains identical.
    The only reason it works now is the CSS change of making the canvas fixed 
    and the main document scrollable.
    */
    var c = document.getElementById('cracker-canvas'),
        w = c.width = window.innerWidth,
        h = c.height = window.innerHeight,
        ctx = c.getContext('2d'),
        hw = w / 2,
        hh = h / 2,
        
        // --- CRITICAL ADDITIONS FOR ANIMATION STATE ---
        particles = [], 
        shards = [], 
        balloons = [],
        // --- END CRITICAL ADDITIONS ---

        opts = {
            strings: [ 'HAPPY', 'BIRTHDAY!', 'PREETU ' , 'SUARNI' ],
            charSize: 30,
            charSpacing: 35,
            lineHeight: 40,
            cx: w / 2,
            cy: h / 2,
            fireworkPrevPoints: 10,
            fireworkBaseLineWidth: 5,
            fireworkAddedLineWidth: 8,
            fireworkSpawnTime: 200,
            fireworkBaseReachTime: 30,
            fireworkAddedReachTime: 30,
            fireworkCircleBaseSize: 20,
            fireworkCircleAddedSize: 10,
            fireworkCircleBaseTime: 30,
            fireworkCircleAddedTime: 30,
            fireworkCircleFadeBaseTime: 10,
            fireworkCircleFadeAddedTime: 5,
            fireworkBaseShards: 5,
            fireworkAddedShards: 5,
            fireworkShardPrevPoints: 3,
            fireworkShardBaseVel: 4,
            fireworkShardAddedVel: 2,
            fireworkShardBaseSize: 3,
            fireworkShardAddedSize: 3,
            gravity: .1,
            upFlow: -.1,
            letterContemplatingWaitTime: 360,
            balloonSpawnTime: 20,
            balloonBaseInflateTime: 10,
            balloonAddedInflateTime: 10,
            balloonBaseSize: 20,
            balloonAddedSize: 20,
            balloonBaseVel: .4,
            balloonAddedVel: .4,
            balloonBaseRadian: -( Math.PI / 2 - .5 ),
            balloonAddedRadian: -1,
        },
        calc = { totalWidth: opts.charSpacing * Math.max( opts.strings[0].length, opts.strings[1].length ) },
        Tau = Math.PI * 2,
        TauQuarter = Tau / 4,
        letters = [];

    ctx.font = opts.charSize + 'px Verdana';

    function Letter(char, x, y){ 
        this.char=char; this.x=x; this.y=y;
        this.dx=-ctx.measureText(char).width/2;
        this.dy=+opts.charSize/2;
        this.fireworkDy=this.y-hh;
        var hue=x/calc.totalWidth*360;
        this.color='hsl(hue,80%,50%)'.replace('hue',hue);
        this.lightAlphaColor='hsla(hue,80%,light%,alp)'.replace('hue',hue);
        this.lightColor='hsl(hue,80%,light%)'.replace('hue',hue);
        this.alphaColor='hsla(hue,80%,50%,alp)'.replace('hue',hue);
        this.reset();
    }
    Letter.prototype.reset = function(){
        this.phase='firework'; this.tick=0; this.spawned=false;
        this.spawningTime=opts.fireworkSpawnTime*Math.random()|0;
        this.reachTime=opts.fireworkBaseReachTime+opts.fireworkAddedReachTime*Math.random()|0;
        this.lineWidth=opts.fireworkBaseLineWidth+opts.fireworkAddedLineWidth*Math.random();
        this.prevPoints=[[0,hh,0]];
    };
    
    // FULL Letter.prototype.step (as provided in your last working snippet)
    Letter.prototype.step = function(){ 
        if(this.phase==='firework'){ 
            if(!this.spawned){ 
                ++this.tick; 
                if(this.tick>=this.spawningTime){ 
                    this.tick=0; this.spawned=true;
                } 
            } else { 
                ++this.tick; 
                var linearProportion=this.tick/this.reachTime, armonicProportion=Math.sin(linearProportion*TauQuarter), 
                x=linearProportion*this.x, y=hh+armonicProportion*this.fireworkDy; 
                
                if(this.prevPoints.length>opts.fireworkPrevPoints) this.prevPoints.shift(); 
                this.prevPoints.push([x,y,linearProportion*this.lineWidth]); 
                var lineWidthProportion=1/(this.prevPoints.length-1); 
                for(var i=1;i<this.prevPoints.length;++i){ 
                    var point=this.prevPoints[i], point2=this.prevPoints[i-1]; 
                    ctx.strokeStyle=this.alphaColor.replace('alp',i/this.prevPoints.length); 
                    ctx.lineWidth=point[2]*lineWidthProportion*i; 
                    ctx.beginPath(); ctx.moveTo(point[0],point[1]); ctx.lineTo(point2[0],point2[1]); ctx.stroke(); 
                } 
                if(this.tick>=this.reachTime){ 
                    this.phase='contemplate'; 
                    this.circleFinalSize=opts.fireworkCircleBaseSize+opts.fireworkCircleAddedSize*Math.random(); 
                    this.circleCompleteTime=opts.fireworkCircleBaseTime+opts.fireworkCircleAddedTime*Math.random()|0; 
                    this.circleCreating=true; 
                    this.circleFading=false; 
                    this.circleFadeTime=opts.fireworkCircleFadeBaseTime+opts.fireworkCircleFadeAddedTime*Math.random()|0; 
                    this.tick=0; this.tick2=0; 
                    this.shards=[]; 
                    var shardCount=opts.fireworkBaseShards+opts.fireworkAddedShards*Math.random()|0, 
                    angle=Tau/shardCount, cos=Math.cos(angle), sin=Math.sin(angle), x=1, y=0; 
                    for(var i=0;i<shardCount;++i){ 
                        var x1=x; x=x*cos-y*sin; y=y*cos+x1*sin; 
                        this.shards.push(new Shard(this.x,this.y,x,y,this.alphaColor)); 
                    } 
                } 
            } 
        } 
        else if(this.phase==='contemplate'){ 
            ++this.tick; 
            if(this.circleCreating){ 
                ++this.tick2; 
                var proportion=this.tick2/this.circleCompleteTime, armonic=-Math.cos(proportion*Math.PI)/2+.5; 
                ctx.fillStyle=this.lightAlphaColor.replace('light',50+50*proportion).replace('alp',proportion); 
                ctx.beginPath(); ctx.arc(this.x,this.y,armonic*this.circleFinalSize,0,Tau); ctx.fill(); 
                if(this.tick2>this.circleCompleteTime){ 
                    this.tick2=0; this.circleCreating=false; this.circleFading=true; 
                } 
            } else if(this.circleFading){ 
                ctx.fillStyle=this.lightColor.replace('light',70); 
                ctx.fillText(this.char,this.x+this.dx,this.y+this.dy); 
                ++this.tick2; 
                var proportion=this.tick2/this.circleFadeTime, armonic=-Math.cos(proportion*Math.PI)/2+.5; 
                ctx.fillStyle=this.lightAlphaColor.replace('light',100).replace('alp',1-armonic); 
                ctx.beginPath(); ctx.arc(this.x,this.y,this.circleFinalSize,0,Tau); ctx.fill(); 
                if(this.tick2>=this.circleFadeTime) this.circleFading=false; 
            } else { 
                ctx.fillStyle=this.lightColor.replace('light',70); 
                ctx.fillText(this.char,this.x+this.dx,this.y+this.dy); 
            } 
            for(var i=0;i<this.shards.length;++i){ 
                this.shards[i].step(); 
                if(!this.shards[i].alive){ 
                    this.shards.splice(i,1); --i; 
                } 
            } 
            if(this.tick>opts.letterContemplatingWaitTime){ 
                this.phase='balloon'; this.tick=0; this.spawning=true; 
                this.spawnTime=opts.balloonSpawnTime*Math.random()|0; 
                this.inflating=false; 
                this.inflateTime=opts.balloonBaseInflateTime+opts.balloonAddedInflateTime*Math.random()|0; 
                this.size=opts.balloonBaseSize+opts.balloonAddedSize*Math.random()|0; 
                var rad=opts.balloonBaseRadian+opts.balloonAddedRadian*Math.random(), 
                vel=opts.balloonBaseVel+opts.balloonAddedVel*Math.random(); 
                this.vx=Math.cos(rad)*vel; this.vy=Math.sin(rad)*vel;
            } 
        } 
        else if(this.phase==='balloon'){ 
            ctx.strokeStyle=this.lightColor.replace('light',80); 
            if(this.spawning){ 
                ++this.tick; 
                ctx.fillStyle=this.lightColor.replace('light',70); 
                ctx.fillText(this.char,this.x+this.dx,this.y+this.dy); 
                if(this.tick>=this.spawnTime){ 
                    this.tick=0; this.spawning=false; this.inflating=true; 
                } 
            } else if(this.inflating){ 
                ++this.tick; 
                var proportion=this.tick/this.inflateTime, 
                x=this.cx=this.x, y=this.cy=this.y-this.size*proportion; 
                ctx.fillStyle=this.alphaColor.replace('alp',proportion); 
                ctx.beginPath(); generateBalloonPath(x,y,this.size*proportion); ctx.fill(); 
                ctx.beginPath(); ctx.moveTo(x,y); ctx.lineTo(x,this.y); ctx.stroke(); 
                ctx.fillStyle=this.lightColor.replace('light',70); 
                ctx.fillText(this.char,this.x+this.dx,this.y+this.dy); 
                if(this.tick>=this.inflateTime){ 
                    this.tick=0; this.inflating=false; 
                } 
            } else { 
                this.cx+=this.vx; 
                this.cy+=this.vy+=opts.upFlow; 
                ctx.fillStyle=this.color; 
                ctx.beginPath(); generateBalloonPath(this.cx,this.cy,this.size); ctx.fill(); 
                ctx.beginPath(); ctx.moveTo(this.cx,this.cy); ctx.lineTo(this.cx,this.cy+this.size); ctx.stroke(); 
                ctx.fillStyle=this.lightColor.replace('light',70); 
                ctx.fillText(this.char,this.cx+this.dx,this.cy+this.dy+this.size); 
                if(this.cy+this.size<-hh||this.cx<-hw||this.cy>hw) this.phase='done'; 
            } 
        }
    };
    
    // Particle constructor is not strictly needed for this version of step()
    // but Shard is essential:
    function Shard(x,y,vx,vy,color){
        var vel=opts.fireworkShardBaseVel+opts.fireworkShardAddedVel*Math.random();
        this.vx=vx*vel; this.vy=vy*vel; this.x=x; this.y=y;
        this.prevPoints=[[x,y]]; this.color=color; this.alive=true;
        this.size=opts.fireworkShardBaseSize+opts.fireworkShardAddedSize*Math.random();
    }
    Shard.prototype.step=function(){
        this.x+=this.vx; this.y+=this.vy+=opts.gravity;
        if(this.prevPoints.length>opts.fireworkShardPrevPoints) this.prevPoints.shift();
        this.prevPoints.push([this.x,this.y]);
        var lineWidthProportion=this.size/this.prevPoints.length;
        for(var k=0;k<this.prevPoints.length-1;++k){
            var point=this.prevPoints[k], point2=this.prevPoints[k+1];
            ctx.strokeStyle=this.color.replace('alp',k/this.prevPoints.length);
            ctx.lineWidth=k*lineWidthProportion;
            ctx.beginPath(); ctx.moveTo(point[0],point[1]); ctx.lineTo(point2[0],point2[1]); ctx.stroke();
        }
        if(this.prevPoints[0][1]>hh) this.alive=false;
    };
    function generateBalloonPath(x,y,size){
        ctx.moveTo(x,y);
        ctx.bezierCurveTo(x-size/2,y-size/2,x-size/4,y-size,x,y-size);
        ctx.bezierCurveTo(x+size/4,y-size,x+size/2,y-size/2,x,y);
    }
    
    function resizeCanvas() {
        w = c.width = window.innerWidth;
        h = c.height = window.innerHeight;
        hw = w / 2;
        hh = h / 2;
        ctx.font = opts.charSize + 'px Verdana';
    }

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function anim(){
        window.requestAnimationFrame(anim);
        // UPDATED: Clear only the visible canvas area with the new pink color (FF69B4)
        ctx.fillStyle='#000000'; 
        ctx.fillRect(0,0,w,h);
        ctx.translate(hw,hh);
        
        // Step through shards (crucial for visual debris)
        shards = shards.filter(s => s.alive); 
        shards.forEach(s => s.step());
        
        var done=true;
        for(var l=0;l<letters.length;++l){
            letters[l].step();
            if(letters[l].phase!=='done') done=false;
        }
        ctx.translate(-hw,-hh);
        if(done) for(var l=0;l<letters.length;++l) letters[l].reset();
    }

    // Initializing letters
    var totalStringWidth = opts.charSpacing * Math.max(opts.strings[0].length, opts.strings[1].length, opts.strings[2].length);
    var startX = -totalStringWidth / 2 + opts.charSpacing / 2;
    var startY = -opts.strings.length * opts.lineHeight / 2 + opts.lineHeight / 2;
    
    for(var i=0;i<opts.strings.length;++i)
        for(var j=0;j<opts.strings[i].length;++j)
            letters.push(new Letter(opts.strings[i][j],
                j*opts.charSpacing + startX,
                i*opts.lineHeight + startY));

    anim();
</script>
<!-- Background music (independent, can load early) -->
<script src="{% static 'backgroundmusic/music.js' %}"></script>

<!-- Card JS (requires jQuery so load AFTER jQuery below; move it down) -->
<!-- DO NOT load card.js here -->


<!-- ---------------------------------------- -->
<!-- 1) jQuery (required for card.js & celeb.js) -->
<!-- ---------------------------------------- -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>


<!-- ------------------------------------------------------------------- -->
<!-- 2) Snap.svg (used by celeb.js) -->
<!-- ------------------------------------------------------------------- -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/snap.svg/0.5.1/snap.svg-min.js"></script>


<!-- ------------------------------------------------------------------- -->
<!-- 3) GSAP v2 (TweenMax) ‚Äî celeb.js NEEDS THIS VERSION -->
<!-- ------------------------------------------------------------------- -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.3/TweenMax.min.js"></script>


<!-- ------------------------------------------------------------------- -->
<!-- 4) GSAP Draggable plugin (v2 syntax, matches celeb.js) -->
<!-- ------------------------------------------------------------------- -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.3/utils/Draggable.min.js"></script>


<!-- ------------------------------------------------------------------- -->
<!-- 5) GSAP EasePack (v2) ‚Äî celeb.js uses it -->
<!-- ------------------------------------------------------------------- -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.3/easing/EasePack.min.js"></script>


<!-- ------------------------------------------------------------------- -->
<!-- 6) NOW load card.js (depends on jQuery) -->


</body>
</html>
